# ğŸ—ºï¸ Visual Data Flow Diagram

## Complete Request Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERFACE                          â”‚
â”‚                        (Next.js Client)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 1. User fills form
                              â”‚    & clicks "Generate"
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      NewPlanForm.tsx                            â”‚
â”‚  - Validates input (place, dates, preferences, companion)       â”‚
â”‚  - Calls server action                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 2. Server Action
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              lib/actions/generateplanAction.ts                  â”‚
â”‚  - Check user credits (need >= 1)                               â”‚
â”‚  - Create plan via Convex mutation                              â”‚
â”‚  - Trigger 4 background jobs                                    â”‚
â”‚  - Reduce credits by 1                                          â”‚
â”‚  - Redirect to plan page                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 3. Convex Mutation
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  convex/plan.ts                                 â”‚
â”‚                  createEmptyPlan()                              â”‚
â”‚                                                                 â”‚
â”‚  Creates records:                                               â”‚
â”‚  â”œâ”€ plan (all fields empty)                                     â”‚
â”‚  â””â”€ planSettings (metadata)                                     â”‚
â”‚                                                                 â”‚
â”‚  contentGenerationState = all false (loading)                   â”‚
â”‚  Returns: planId                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 4. Triggers Background Jobs
                              â”‚    (All run in parallel!)
                              â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚               â”‚               â”‚               â”‚
              â–¼               â–¼               â–¼               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   IMAGE     â”‚ â”‚   BATCH 1   â”‚ â”‚   BATCH 2   â”‚ â”‚   BATCH 3   â”‚
    â”‚  (Unsplash) â”‚ â”‚  (OpenAI)   â”‚ â”‚  (OpenAI)   â”‚ â”‚  (OpenAI)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚               â”‚               â”‚               â”‚
           â”‚               â”‚               â”‚               â”‚
           â–¼               â–¼               â–¼               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚              MUTATION UPDATES (As they complete)            â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ 1. imageUrl = "https://..."                                 â”‚
    â”‚    contentGenerationState.imagination = true                â”‚
    â”‚                                                             â”‚
    â”‚ 2. abouttheplace = "Paris is..."                           â”‚
    â”‚    besttimetovisit = "Spring & Fall..."                    â”‚
    â”‚    contentGenerationState.abouttheplace = true             â”‚
    â”‚    contentGenerationState.besttimetovisit = true           â”‚
    â”‚                                                             â”‚
    â”‚ 3. adventuresactivitiestodo = ["Eiffel...", "Louvre..."]  â”‚
    â”‚    localcuisinerecommendations = ["Croissant", ...]       â”‚
    â”‚    packingchecklist = ["Passport", "Camera", ...]         â”‚
    â”‚    contentGenerationState.* = true                         â”‚
    â”‚                                                             â”‚
    â”‚ 4. itinerary = [{day 1...}, {day 2...}, ...]              â”‚
    â”‚    topplacestovisit = [{name, coords}, ...]               â”‚
    â”‚    contentGenerationState.* = true                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 5. Convex pushes updates
                              â”‚    (WebSocket, real-time)
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    REACT COMPONENTS                             â”‚
â”‚                                                                 â”‚
â”‚  hooks/usePlan.ts                                               â”‚
â”‚  â””â”€ useQuery(api.plan.getSinglePlan)                            â”‚
â”‚     â””â”€ Automatically re-runs when data changes!                 â”‚
â”‚                                                                 â”‚
â”‚  components/plan/Plan.tsx                                       â”‚
â”‚  â””â”€ Reads plan.contentGenerationState                           â”‚
â”‚     â””â”€ Shows skeleton OR content for each section               â”‚
â”‚                                                                 â”‚
â”‚  components/debug/PlanDebugger.tsx                              â”‚
â”‚  â””â”€ Shows real-time status of each section                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 6. React re-renders
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USER SEES                                â”‚
â”‚                                                                 â”‚
â”‚  Progressive Loading:                                           â”‚
â”‚  â±ï¸ 0s   â†’ Loading skeletons (gray boxes)                       â”‚
â”‚  â±ï¸ 5s   â†’ Image appears                                        â”‚
â”‚  â±ï¸ 10s  â†’ About & Best Time sections                           â”‚
â”‚  â±ï¸ 15s  â†’ Activities, Cuisine, Packing                         â”‚
â”‚  â±ï¸ 25s  â†’ Itinerary & Top Places (with map!)                   â”‚
â”‚  âœ… 30s  â†’ Complete! All sections loaded                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Hierarchy

```
app/
â”œâ”€ layout.tsx
â”‚  â””â”€ ConvexClientProvider
â”‚     â””â”€ ClerkProvider
â”‚        â””â”€ ConvexProviderWithClerk
â”‚           â”‚
â”‚           â””â”€ dashboard/
â”‚              â””â”€ page.tsx
â”‚                 â””â”€ Dashboard.tsx
â”‚                    â”œâ”€ useQuery(getAllPlansForAUser)
â”‚                    â””â”€ NewPlanForm.tsx
â”‚                       â””â”€ PlacesAutoComplete
â”‚                       â””â”€ DateRangeSelector
â”‚                       â””â”€ ActivityPreferences
â”‚                       â””â”€ CompanionControl
â”‚
â””â”€ plans/[planId]/(private)/
   â””â”€ layout.tsx
      â””â”€ PlanLayoutContent
         â””â”€ Sidebar (navigation)
         â”‚
         â””â”€ plan/page.tsx
            â””â”€ PlanDebugger â† NEW! Shows status
            â””â”€ Plan.tsx
               â””â”€ PlanContextProvider
                  â”œâ”€ usePlan(planId)
                  â”‚  â””â”€ useQuery(getSinglePlan)
                  â”‚
                  â””â”€ Plan sections:
                     â”œâ”€ ImageSection
                     â”œâ”€ AboutThePlace
                     â”œâ”€ Weather
                     â”œâ”€ TopActivities
                     â”œâ”€ TopPlacesToVisit (with Map)
                     â”œâ”€ Itinerary (Timeline)
                     â”œâ”€ LocalCuisineRecommendations
                     â”œâ”€ PackingChecklist
                     â””â”€ BestTimeToVisit
```

---

## Data Flow Timeline

```
Time    â”‚ Frontend                    â”‚ Backend (Convex)           â”‚ External
â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0s      â”‚ Form submitted              â”‚                            â”‚
        â”‚ "Generating..." toast       â”‚                            â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1s      â”‚ Redirect to /plans/{id}     â”‚ createEmptyPlan mutation   â”‚
        â”‚ Debug panel: 0%             â”‚ Returns planId             â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2s      â”‚ Loading skeletons shown     â”‚ 4 actions queued:          â”‚
        â”‚ useQuery() watching...      â”‚ - images:generateAndStore  â”‚
        â”‚                             â”‚ - plan:prepareBatch1       â”‚
        â”‚                             â”‚ - plan:prepareBatch2       â”‚
        â”‚                             â”‚ - plan:prepareBatch3       â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
5s      â”‚ Image appears! 12% âœ“        â”‚ Image mutation complete    â”‚ Unsplash
        â”‚ React auto-rerender         â”‚                            â”‚ API call
â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
10s     â”‚ About section fills         â”‚ Batch1 mutation complete   â”‚ OpenAI
        â”‚ Best Time section fills     â”‚ - abouttheplace            â”‚ API call
        â”‚ Debug: 37% âœ“                â”‚ - besttimetovisit          â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
15s     â”‚ Activities appear           â”‚ Batch2 mutation complete   â”‚ OpenAI
        â”‚ Cuisine appears             â”‚ - adventuresactivitiestodo â”‚ API call
        â”‚ Packing appears             â”‚ - localcuisinerecommend... â”‚
        â”‚ Debug: 62% âœ“                â”‚ - packingchecklist         â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
25s     â”‚ Itinerary expands           â”‚ Batch3 mutation complete   â”‚ OpenAI
        â”‚ Map shows markers           â”‚ - itinerary                â”‚ API call
        â”‚ Debug: 87% âœ“                â”‚ - topplacestovisit         â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
30s     â”‚ All complete! 100% âœ…       â”‚ All mutations done         â”‚
        â”‚ Edit buttons enabled        â”‚ Plan fully generated       â”‚
        â”‚ Share button enabled        â”‚                            â”‚
```

---

## State Management Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Convex Database                            â”‚
â”‚                                                               â”‚
â”‚  plan table:                                                  â”‚
â”‚  {                                                            â”‚
â”‚    _id: "j97...",                                             â”‚
â”‚    nameoftheplace: "Paris, France",                           â”‚
â”‚    abouttheplace: "",              â† Starts empty             â”‚
â”‚    itinerary: [],                  â† Starts empty             â”‚
â”‚    contentGenerationState: {                                  â”‚
â”‚      abouttheplace: false,         â† Loading indicator        â”‚
â”‚      itinerary: false,             â† Loading indicator        â”‚
â”‚      ...                                                      â”‚
â”‚    }                                                          â”‚
â”‚  }                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Convex WebSocket (real-time sync)
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  React Component State                        â”‚
â”‚                                                               â”‚
â”‚  const plan = useQuery(api.plan.getSinglePlan, {id})          â”‚
â”‚                                                               â”‚
â”‚  // Automatically updates when Convex data changes!          â”‚
â”‚  // No manual polling needed                                 â”‚
â”‚                                                               â”‚
â”‚  {plan.abouttheplace ? (                                      â”‚
â”‚    <div>{plan.abouttheplace}</div>  â† Shows content           â”‚
â”‚  ) : (                                                        â”‚
â”‚    <Skeleton />                     â† Shows loading           â”‚
â”‚  )}                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Mutation Flow (Backend)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Action (External API)                   â”‚
â”‚                 convex/plan.ts                             â”‚
â”‚                                                            â”‚
â”‚  export const prepareBatch1 = action({                     â”‚
â”‚    handler: async (ctx, { planId }) => {                   â”‚
â”‚      // 1. Fetch current plan                             â”‚
â”‚      const plan = await fetchEmptyPlan(ctx, planId);       â”‚
â”‚                                                            â”‚
â”‚      // 2. Call OpenAI                                    â”‚
â”‚      const completion = await generatebatch1(              â”‚
â”‚        plan.userPrompt                                     â”‚
â”‚      );                                                    â”‚
â”‚                                                            â”‚
â”‚      // 3. Parse response                                 â”‚
â”‚      const data = JSON.parse(                              â”‚
â”‚        completion.choices[0].message.function_call.args    â”‚
â”‚      );                                                    â”‚
â”‚                                                            â”‚
â”‚      // 4. Update database                                â”‚
â”‚      await ctx.runMutation(                                â”‚
â”‚        internal.plan.updateAboutThePlaceBestTimeToVisit,   â”‚
â”‚        {                                                   â”‚
â”‚          planId,                                           â”‚
â”‚          abouttheplace: data.abouttheplace,                â”‚
â”‚          besttimetovisit: data.besttimetovisit             â”‚
â”‚        }                                                   â”‚
â”‚      );                                                    â”‚
â”‚    }                                                       â”‚
â”‚  });                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Calls
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Mutation (Database Update)                    â”‚
â”‚                                                            â”‚
â”‚  export const updateAboutThePlaceBestTimeToVisit =         â”‚
â”‚    internalMutation({                                      â”‚
â”‚      handler: async (ctx, args) => {                       â”‚
â”‚        const plan = await ctx.db.get(args.planId);         â”‚
â”‚                                                            â”‚
â”‚        await ctx.db.patch(args.planId, {                   â”‚
â”‚          abouttheplace: args.abouttheplace,                â”‚
â”‚          besttimetovisit: args.besttimetovisit,            â”‚
â”‚          contentGenerationState: {                         â”‚
â”‚            ...plan.contentGenerationState,                 â”‚
â”‚            abouttheplace: true,    â† Mark complete         â”‚
â”‚            besttimetovisit: true   â† Mark complete         â”‚
â”‚          }                                                 â”‚
â”‚        });                                                 â”‚
â”‚      }                                                     â”‚
â”‚    });                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Convex auto-pushes update
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                All Connected Clients                       â”‚
â”‚             (React components re-render)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Real-time Sync Magic

```
                    CONVEX MAGIC âœ¨
                         
   Backend (Convex)              Frontend (React)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€             â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        â”‚                              â”‚
        â”‚ 1. Mutation updates DB       â”‚
        â”‚    plan.abouttheplace =      â”‚
        â”‚    "Paris is beautiful..."   â”‚
        â”‚                              â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
        â”‚ 2. WebSocket push            â”‚
        â”‚    "Hey! Data changed!"      â”‚
        â”‚                              â”‚
        â”‚                              â”‚ 3. useQuery auto-reruns
        â”‚                              â”‚    Fetches new data
        â”‚                              â”‚
        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ 4. Returns updated plan      â”‚
        â”‚                              â”‚
        â”‚                              â”‚ 5. React re-renders
        â”‚                              â”‚    Shows new content!
        â”‚                              â”‚
        
   NO POLLING! NO MANUAL REFETCH! JUST MAGIC! ğŸ©âœ¨
```

---

## Debug Panel States

```
Initial State (0%)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Plan Generation Status                  â”‚
â”‚ Paris, France                     0%    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â³ Image        Processing               â”‚
â”‚ â³ About        Processing               â”‚
â”‚ â³ Best Time    Processing               â”‚
â”‚ â³ Activities   Processing               â”‚
â”‚ â³ Top Places   Processing               â”‚
â”‚ â³ Itinerary    Processing               â”‚
â”‚ â³ Cuisine      Processing               â”‚
â”‚ â³ Packing      Processing               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Mid-Generation (50%)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Plan Generation Status                  â”‚
â”‚ Paris, France                    50%    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ Image         Complete                â”‚
â”‚ âœ“ About         Complete                â”‚
â”‚ âœ“ Best Time     Complete                â”‚
â”‚ âœ“ Activities    Complete                â”‚
â”‚ â³ Top Places    Processing              â”‚
â”‚ â³ Itinerary     Processing              â”‚
â”‚ â³ Cuisine       Processing              â”‚
â”‚ â³ Packing       Processing              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Complete (100%)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Plan Generation Status                  â”‚
â”‚ Paris, France                   100%    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ Image         Complete                â”‚
â”‚ âœ“ About         Complete                â”‚
â”‚ âœ“ Best Time     Complete                â”‚
â”‚ âœ“ Activities    Complete                â”‚
â”‚ âœ“ Top Places    Complete                â”‚
â”‚ âœ“ Itinerary     Complete                â”‚
â”‚ âœ“ Cuisine       Complete                â”‚
â”‚ âœ“ Packing       Complete                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FRONTEND                             â”‚
â”‚                  Next.js 15 App Router                      â”‚
â”‚                                                             â”‚
â”‚  Client Components (useState, useEffect, etc)               â”‚
â”‚  Server Components (async, direct DB access)                â”‚
â”‚  Server Actions (form handling, redirects)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Convex Client SDK
                         â”‚ (WebSocket + HTTP)
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        BACKEND                              â”‚
â”‚                     Convex Platform                         â”‚
â”‚                                                             â”‚
â”‚  â”œâ”€ Queries (real-time data fetching)                       â”‚
â”‚  â”œâ”€ Mutations (data modifications)                          â”‚
â”‚  â”œâ”€ Actions (external API calls)                            â”‚
â”‚  â”œâ”€ Scheduled Functions (cron jobs)                         â”‚
â”‚  â””â”€ HTTP Endpoints (webhooks)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
                    â”‚         â”‚
                    â–¼         â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   OpenAI     â”‚   Unsplash   â”‚
         â”‚   GPT-4      â”‚   Images     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

This visual guide should help you understand exactly how data flows through your application! ğŸ¨
